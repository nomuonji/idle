# アイドルMV再生数応援Bot システム設計書

## 概要
YouTube上の特定アイドルグループ（まずはSnow Man）のMusic Video (MV) の再生回数を定期的に監視し、特定のマイルストーン（キリ番や達成目前）に到達した際に、X (旧Twitter) へ自動で応援・祝福ポストを行うシステムです。

## 特徴
- **拡張性**: 設定ファイル (`config.yaml`) にグループ名やチャンネルIDを追加するだけで、他のグループにも容易に横展開可能。
- **データ管理**: SQLiteデータベースを使用し、各動画の前回の再生数や、すでに通知済みのマイルストーンを管理。重複投稿を防ぎます。
- **自動化**: スケジューラー（Windowsタスクスケジューラ等）と連携し、バックグラウンドで定期実行可能。

## システム必要要件
- **Python 3.10+**
- **YouTube Data API v3 API Key** (情報の取得に必要)
- **X (Twitter) API Key** (投稿に必要)
  - ※API取得が難しい場合は、Selenium等によるブラウザ操作での実装も検討しますが、安定性の観点からAPI利用を推奨します。

## ディレクトリ構造
```
d:/youph/Marketing/idle/
├── config/
│   └── config.yaml        # グループ設定、APIキー、メッセージテンプレート
├── db/
│   └── mv_data.db         # 再生数・投稿履歴データベース (SQLite)
├── src/
│   ├── youtube_client.py  # YouTube API連携クラス
│   ├── x_client.py        # X API連携クラス
│   ├── logic.py           # 投稿判定ロジック（達成・応援判定）
│   └── main.py            # メイン実行スクリプト
├── logs/                  # 実行ログ
└── requirements.txt       # 依存ライブラリ
```

## 処理フロー
1. **設定読み込み**: 対象アーティスト、マイルストーン設定（例: 100万回ごと、達成手前1万回など）をロード。
2. **YouTubeデータ取得**: 
   - 対象チャンネルの動画リストを取得/更新。
   - 各動画の最新再生回数を取得。
3. **判定ロジック**:
   - **達成判定**: 前回チェック時と現在の再生数を比較し、マイルストーンをまたいでいれば「達成ツイート」を作成。
   - **応援判定**: 次のマイルストーンまで残り僅か（設定値以内）であれば「応援ツイート」を作成。
     - *頻度制御*: 短期間に何度も応援しないよう、前回の応援日時からの経過時間を考慮。
4. **X投稿**: 生成されたメッセージを投稿。
5. **DB更新**: 現在の再生数と投稿履歴を保存。

## メッセージ例
- **達成時**: 🎉【#SnowMan】「Dangerholic」が1,000万回再生を突破しました！おめでとうございます！ ☃️ #目黒蓮 #佐久間大介 ... [動画リンク]
- **応援時**: 🔥【#SnowMan】「LOVE TRIGGER」もう少しで500万回再生です！あと3,500回！みんなで回そう！💨 [動画リンク]

---
## 次のアクション
この設計で進めてよろしければ、ベースとなるコードの実装を開始します。
**事前に以下のAPIキーのご用意状況を教えてください。**
1. **YouTube Data API v3**: 無料枠で十分運用可能です。
2. **X (Twitter) API**: Freeプラン（書き込みのみ）またはBasicプラン等。もしお持ちでない場合は、ブラウザ自動操作（Selenium等）での代替を検討する必要があります。
